\chapter{Energy Saving in Peer-Assisted CDN}

\section{Motivation}
Streaming content, especially video, represents a significant fraction of the traffic volume on the Internet, and it has become a standard practice to deliver this type of content using Content Delivery Networks (CDNs) such as Akamai and Limelight for better scaling and quality of experience for the end users.  
For example, YouTube uses Google cache and MTV uses Akamai in their operations.

With the spread of broadband Internet access at a reasonable flat monthly rate, users are connected to the Internet 24 hours a day and they can download and share multimedia content.  
P2P (peer to peer) applications are also widely deployed.  In China, P2P is very popular; we see many P2P applications from China such as PPLive, PPStream, UUSe, Xunlei, etc. \cite{Vu:2010:UOC:1865106.1865115}.  
Some news broadcasters also rely on P2P technology to deliver popular live events.  
For example, CNN uses the Octoshape solution that enables their broadcast to scale and offer good video quality as the number of users increases \cite{octoshape}.

From the Internet provider point of view, the presence of so many always-on users suggests that it is possible to delegate a portion of computing, storage and networking tasks to the users, thus creating P2P networks where users can share files and multimedia content. 
Starting from file sharing protocols, P2P architectures have evolved toward video on demand and support for live events.

Broadband network access helps P2P applications to perform better. 
xDSL networks are deployed worldwide, and in some countries, such as Japan, even higher bandwidth fiber to the home (FTTH) already exceeds DSL in market penetration. 
In the coming years, network operators throughout the world will massively deploy FTTH.  
As access bandwidth increases, P2P systems may become more efficient since a peer can contribute much more.

In Peer assisted CDN \footnote{In this paper we use Peer Assisted CDN and CDN-P2P interchangeably.}, users can download content from CDN nodes from or other users or peers. 
A user may cache the content after download to serve requests from other users. 
Due to the complexity of the behavior of peers, the process should be done in the home gateway user where the ISP can control it.

On the other hand, the data center where the CDN server is placed faces costs for powering the data center. 
The Uptime Institute, a global data center authority, surveyed $1100$ data center owners and operators in 2012 and reported that $55$\% of organizations will increase their financial budget $10$\% over 2011 \cite{uptime}.
$30$\% of organizations were expected run out of data center capacity (power, cooling, space, and network) by the end of 2012 \cite{uptime}.  
More than $50$\% of the organizations surveyed reported that saving energy \footnote{As we are discussing steady-state operation, energy and power are in direct correspondence so we use the terms interchangeably.}  is a major priority. 
Even in the data centers using the state of art cooling technologies heat dissipation accounts for at least $20$\% and as much as $50$\% of the total power consumption \cite{google}. 
The increases in energy cost and the demand due to growth of traffic urges the data center operators and owners to look for ways to reduce energy usage in the years to come. 
Although reducing energy consumption can effectively reduce overall cost, this will limit the capacity for growth and scalability of the service provisioning. 
For example: routers and servers spend most of their energy on the baseline activities such as running the fans, spinning disk, powering the backplane, and powering the memory. 
Even in an idle state, modern systems can be consuming anything from $50$\% to $80$\% of the power consumed under maximum load \cite{4404806,4509688}. 

Alternatively, the data center can be revamped by relocating some services to end-host computers or peers. 
Peers contribute their communication, storage, and computation resources to exchange data and provide services while the data center performs central administration and authentication as well as backend processing. 
A P2P network formed by peers offers flexibility and scalability in service delivery. 

We study the energy consumption of hybrid CDN-P2P in two use cases: live streaming and online storage services.  
It has been shown that CDN energy consumption is better than P2P architecture \cite{feldmann2010energy,baliga2007energy}. 
The questions are: with the opportunity to offload the CDN’s workload to the peers, how much energy saving can the CDN server get and how large is the difference compared to a pure CDN architecture.  
If we can estimate the difference between a CDN architecture and a peer-assisted CDN combined with an estimate of peer power consumption, we can use this difference as a basis calculation for giving an incentive to users since peer assisted relies heavily on the user’s uptime and upload rate. 
Furthermore, since the power consumption is reduced, the power requirement inside the data center can be reduced thus relaxing capacity planning. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{System Description}\label{system model}
\subsection{Live Streaming}

\begin{figure}[thb]
\begin{center}
\includegraphics[scale=0.7]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/livesky.eps}
\end{center}
\caption{Example model of peer-assisted online storage architecture.}
\label{fig:iptv}
\end{figure} 

Figure \ref{fig:iptv} shows an example model of a peer-assisted CDN for live streaming adapted from \cite{Yin:2010:LEC:1823746.1823750}. 
CDN servers deliver video contents from the content provider to end-users. 
The CDN usually is organized into several tiers usually to cope with the scale demand. 
Edge CDN servers are directly responsible for serving end users. 
The goal of the server side peer is for efficient data distribution with some measures to guard against some node failures and network delay.

The CDN overlay is largely tree-based. 
To provide greater reliability, a CDN node may allow retrieving the content either from other nodes. 
Edge CDN servers are responsible for serving end users

For this system, we introduce the concepts of seeder and leecher. 
A peer that is served by an edge CDN server is called a seeder while a peer that is served by seeders is called a leecher.

A peer obtains the URL from a content source.  
The global server load balancer finds a suitable edge CDN node for this peer. 
The peer is then redirected to the nearest edge CDN. 
The edge CDNs has decision logic that decides if a new peer should be served directly by the edge CDN or if it should be redirected to the P2P overlay.

In the P2P overlay, the stream is separated into several substreams according the stream id and peers are organized in a tree-based overlay. 
A working peer-assisted CDN live streaming system is defined by parameters such as: (1) video bitrate, (2) the total number of peers, (3) the edge CDN servers bandwidth, and (4) peer upload bandwidth capacity and churn rates. 

The maximum number of seeders is bounded by the CDN's capacity, while the maximum number of leechers is bounded by the number of seeders with a certain upload rate.
Let us denote the number of the seeders by $n_s$, the number of leechers by $n_l$, the maximum bitrate supplied by seeders to leechers by $\rho$, and the video bitrate by $r$. 
The number of leechers that can be supported by seeders is:

\begin{equation}\label{eqn:leecher}
	\lfloor n_l \rfloor = n_s . \rho
\end{equation}

The number of seeders that support or upload content to leechers is:

\begin{equation}\label{eqn:seeders-to-leechers}
	n_{s}^{u} = n_l . \frac{r}{\rho}
\end{equation}

In peer-assisted live streaming, we introduce the utilization policy where the CDN server admits peers as seeders as long as the CDN utilization does not exceed $50$\%, which we defined as $50$\% of the capacity of a Gigabit Ethernet. 
When the utilization hits $50$\%, incoming peers are admitted as leechers, hence they receive the contents from seeders. 
When more peers join the system and the upload capacity of the seeders is exceeded, the policy raises the utilization cap and the server admits the newly joined peers as seeders. 
We consider this policy to be better than adding a new server from the point of view of energy consumption.

\subsection{Peer-Assisted Online Storage}

\begin{figure}[thb]
\begin{center}
\includegraphics[scale=0.7]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/fs2you-arch.eps}
\end{center}
\caption{Example model of peer-assisted online storage architecture.}
\label{fig:fs2you-arch}
\end{figure} 

Figure \ref{fig:fs2you-arch} illustrates the architecture of peer-assisted online storage for a file hosting system (one-click hosting service with peer-assistance) and interactions among the main components \cite{5061997}. 
In this system, each file provided by users is treated as a swarm. Each end user is treated as a peer.

In Fig.\ref{fig:fs2you-arch}, arrows 1, 2, and 3 denote the interaction between a participating peer and tracking server and replication servers for uploading a new file. 
Arrows 4, 5, and 6 denote the interaction between peers and the tracking server to maintain the peer topology. 
Arrow 7 denotes the sharing of the file and exchange of availability data among peers. 
Arrows 8 and 9 represent peer requests and server response.

The tracking server’s function is to maintain swarm information and bootstraps peers. 
Replication servers working as dedicated content servers have a function for maintaining the availability of swarms when peers do not actively serve them alone. 

We choose this peer-assisted online storage model because this model has been implemented widely in China, e.g. FS2You \cite{fs2you}, and because one-click file hosting services are very popular right now \cite{Mahanti:2011:MAC:1963192.1963346}. 
Such services rely heavily on server farms inside the data center, thus energy cost becomes important \cite{arstechnica}. 
In this model, since the server holds an important role in this system, we present a simple mathematical model of server bandwidth allocation strategies as a basis for energy calculations \cite{4199285,Sun:2009:POS:1542245.1542249}, as follows: 

\begin{itemize}
\item Type-1 represents less popular files and type-2 represents popular files. 
\item $S_{t1}$ represents server bandwidth allocated to a type-1 file and $S_{t2}$ represents server bandwidth allocated to a type-2 file. 
\item $S$ is the total server bandwidth.
\item $S_{max1}$ is the maximum amount of server bandwidth that can be assigned to a file of type-1 and $S_{max2}$ is the maximum amount of server bandwidth that can be assigned to a file of type-2.
\item $M_{t1}$ is the number of type-1 files and $M_{t2}$ is the number of type-2 files.
\item $\mu$ is upload rate of a peer.
\item $\alpha_{t1}$ is the arrival rate of new peers in type-1 file and $\alpha_{t2}$ is the arrival rate of new peers in type-2 file.
\item $\alpha = M_{t1} \alpha_{t1} + M_{t2} \alpha_{t2}$
\item $M=M_{t1} + M_{t2}$ 
\item $\eta_{t1}$  is the file sharing effectiveness. It is the fraction of the upload capacity of peers that is being utilized for type-1 file.
\item $\eta_{t2}$  is the file sharing effectiveness. It is the fraction of the upload capacity of peers that is being utilized for type-2 file.
\item $T_d$ is the average downloading time. 
\item $x_i$ is the average number of peers.
\end{itemize}

There are three server bandwidth allocation strategies: (1) lower bound of the average downloading time; (2) request driven strategy; (3) water leveling strategy. 
In the lower bound strategy, the server uses the bandwidth for type-1 files until $S_{t1}$ reaches its maximum value, then the residual server bandwidth can be assigned to type-2 files. 
In the request driven strategy, the server serves every request from peers. 
The server bandwidth is equally divided among all the peers. Let’s assume that the number of requests for a file to the server is proportional to the peer arrival rate of the file. 
Let’s also assume that when the amount of server bandwidth assigned to one of the two types of files has reached its maximum value, the residual server bandwidth will be assigned to the other type of file. 
In the water leveling strategy, the server bandwidth is equalized across all the files by taking file popularity into consideration. 
The server serves the requests from peers according to a certain probability, which is inversely proportional to the peer arrival rate of the file.
Let’s assume that the number of requests for a file to the server is proportional to the peer arrival rate of the file, the server will serve the same number of requests for different files and therefore the server bandwidth is equally allocated across all the files.  
In order to be able to calculate our power consumption, we need to get the number of peers in the system that can be expressed as \cite{Sun:2009:POS:1542245.1542249}:

\begin{equation}\label{eqn:numofpeers}
\begin{split}
\sum x_i = T_d . \sum \lambda_i
\end{split}     
\end{equation} 

Furthermore, we can calculate $T_d$:

\begin{equation}\label{eqn:averagetimedownload}
\begin{split}
T_d &= \frac{1}{M_{t1}.\lambda_{t1} + M_{t2}.\lambda_{t2}}\left(\frac{M_{t1}.f_{t1}.\lambda_{t1}.\eta_{t2} + M_{t2}.f_{t2}.\lambda_{t2}.\eta_{t1}}{\mu.\eta_{t1}.\eta_{t2}} - \frac{S_{t1} (M_{t1}.\eta_{t2}-M_{t2}.\eta_{t1}) + S.M_{t2}.\eta_{t1}}{\mu.\eta_{t1}.\eta_{t2}}\right) 
\end{split}     
\end{equation} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Energy Model}\label{thermodynamics}

However, the COP for a cooling cycling is not constant, increasing with the temperature of the air the cooling unit pushes into the plenum.  
COP value empirically can be computed using \cite{moore2005making}:

\begin{equation}\label{eqn:copt}
	COP(T) = 0.0068.T^2 + 0.0008.T + 0.458
\end{equation}

where $T = T_{sup} + T_{adj}$ and $T_{adj} = T_{safe}^{in}-T_{max}^{in}$. \\
$T_{sup}$ is temperature supply by cooling unit and $T_{adj}$ is temperature difference between maximum safe hardware inlet temperature ($T_{safe}^{in}$) and the maximum observed hardware inlet temperature ($T_{max}^{in}$).
If $T_{adj}$ is negative, it indicates that a hardware inlet exceeds maximum safe temperature thus we need to lower $T_{sup}$ to bring the hardwares back below the system redline level.

\begin{figure}[thb]
\begin{center}
\includegraphics[scale=0.8]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/cop.eps}
\end{center}
\caption{COP curve for the chilled water cooling units from HP Lab utility data center.
As the target temperature of the air the cooling unit pumps into the floor plenum increases, the COP increases.}
\label{fig:twotier}
%\vspace{-2mm}
\end{figure} 

Cooling cost can be calculated as  \cite{moore2005making} :

\begin{equation}\label{eqn:cost}
C = \frac{Q}{COP(T)}
\end{equation}

Where $Q$ is amount of power the servers and hardwares consume.
COP(T) is our COP at $T=T_{sup}+T_{adj}$.
Currently we assume a uniform $T_{sup}$ from each cooling units due to the complications introduced by non-uniform cold air supply.


%%%%%%%%
\subsection{Energy Model}\label{energy model}

In this paper, our goal is to provide a general view and a fair comparison of the energy consume by a CDN and hybrid CDN-P2P architecture. 
To do so, we designed a series of model and perform an analysis.
Our energy model is similar to the models used in \cite{Nedevschi:2008:HDC:1855610.1855618}.
Network model for energy is assumed to be flat network as shown in fig.\ref{fig:iptv}.

For each component, we consider two energy measurement:  baseline energy consumption and energy consumed per work unit $\delta$.
The baseline energy is the energy consumed to keep the device on.
Even when there is no traffic, the device still consume energy.
The energy consumption for a single request in CDN server as:
\begin{equation}\label{eqn:E_d}
	E_{d} = E_s
\end{equation}
while the energy consumption for a single request in network as:
\begin{equation}\label{eqn:E_r}
	E_{r} = d_s.E_r
\end{equation}
and energy of peer or client is $E_p$.

where $d_s$ is number of hops or the path length.
We define $\delta_s$ and $\delta_r$ work-induced energy consumed per additional bit transferred by a server and router.   
We can express these per-bit work induced consumptions as follows:
\begin{equation}\label{eqn:delta_s}
	\delta_s = \frac{(S_{max} - S_{base})}{M_s} 
\end{equation}
$S_{base}$ is a server's baseline power consumption.  
$S_{max}$ is a server's power when operating at maximum capacity.
$M_s$ is the maximum capacity in bit per second for a server.
Same formulation also applied for network component.  
\begin{equation}\label{eqn:delta_r}
	\delta_r = \frac{(R_{max} - R_{base})}{M_R} 
\end{equation}
$R_{max}$ is a router power when operating at maximum capacity.
$R_{base}$ is a router's baseline power consumption.
$M_R$ is maximum capacity in bit per second for a router.

Substituting eq.\ref{eqn:delta_s}, and eq.\ref{eqn:delta_r} to eq.\ref{eqn:E_d} and eq.\ref{eqn:E_r}, we can rewrite eq.\ref{eqn:E_d} and eq.\ref{eqn:E_r} as follows:
\begin{equation}\label{eqn:E_ddanE_r}
\begin{split}
	E_{d} &= \delta_s.B + E_{s-baseline}\\
	E_{r} &= d_s.\delta_r.B + E_{r-baseline}\\
	E_{p} &= \delta.B + E_{p-baseline}
\end{split}
\end{equation}
Finaly total energy is:
\begin{equation}\label{eqn:E_t}
\begin{split}
	E_{t} &= E_d + E_r + E_p \\
	E_{t} &= \delta_s.B + E_{s-baseline} + d_s.\delta_r.B + E_{r-baseline} + \delta_p.B + E_{p-baseline}
\end{split}
\end{equation}
where $B$ is size of file to be transferred. 

Considering cooling energy, we can substitute eq.\ref{eqn:cost} to eq.\ref{eqn:E_t}, therefore total energy consumed: 
\begin{equation}
	\hat{E}_{t} = E_{t}.\left( 1+\frac{1}{COP(T)} \right)
\end{equation}


\section{Result and Discussion}\label{analysis}
\subsection{Live Streaming}
For numerical simulation, we use work induced energy consumed per second from \cite{Nedevschi:2008:HDC:1855610.1855618}.
For CDN server baseline, we use server idle power $E_{s-baseline}=290$ watt and router baseline power $E_{r-baseline}=750$ watt \cite{Nedevschi:2008:HDC:1855610.1855618}. 
For peer baseline, we use peer base power $E_{p-baseline}=13.5$ watt \cite{valancius2009greening}.
The peer has 256MB flash storage.
%The dummy network model used in this numerical simulation is shown in fig.\ref{fig:dummy}.
The data flows from CDN to network in this case router then arrive in seeders. 
If seeders need to upload data to leechers then, it will flows through router then arrive in leechers. 
Parameters values used in this numerical simulation is shown in table \ref{tab:simparameters}.
\begin{table}[thb]
\caption{Numerical Simulation Parameters.}
\label{tab:simparameters}
\hbox to\hsize{\hfil
\begin{tabular}{l|l}\hline\hline
Symbol & Value\\\hline
$\delta_s$ & $5.2 . 10^{-8}$ (J/b)\\
$\delta_r$ & $8.0 . 10^{-9}$ (J/b)\\
$\delta_p$ & $16 . 10^-9$ (J.b)\\
$E_{r-baseline}$ & $750$ watt \\
$E_{s-baseline}$ & $290$ watt \\
$E_{p-baseline}$ & $13.5$ watt \\
%%$B$ & $500$MB\\
$d_s$ & $1$ \\
$N_{s}^{u}$ & $[0.25,0.5,0.75,1]$ Mbps \\
$N$ & $[100,..,1000]$ \\
$T$ & $[20,25]$ correspond to COP value $[3.194,4.728]$\\\hline
\end{tabular}\hfil}
\end{table}

\begin{figure}[thb]
\begin{center}
\includegraphics[scale=0.6]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/topology.eps}
\end{center}
\caption{Dummy network}
\label{fig:dummy}
\vspace{-2mm}
\end{figure} 


\begin{figure*}[t]
\centering
\begin{minipage}[b]{0.3\linewidth}
	\includegraphics[scale=0.5]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/cdn.eps}
	\caption{CDN.}
	\label{fig:4-0}
\end{minipage}
\hfill
\begin{minipage}[b]{0.3\linewidth}
	\includegraphics[scale=0.5]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/cdnp2p-1.eps}
	\caption{CDN-P2P $\rho=0.25$.}
	\label{fig:4-1}
\end{minipage}
\hfill
\begin{minipage}[b]{0.3\linewidth}
	\includegraphics[scale=0.5]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/cdnp2p-2.eps}
	\caption{CDN-P2P $\rho=0.5$.}
	\label{fig:4-2}
\end{minipage}
\hfill
\begin{minipage}[b]{0.35\linewidth}
	\includegraphics[scale=0.5]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/cdnp2p-3.eps}
	\caption{CDN-P2P $\rho=0.75$.}
	\label{fig:4-3}
\end{minipage}
\hfill
\begin{minipage}[b]{0.35\linewidth}
	\includegraphics[scale=0.5]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/cdnp2p-4.eps}
	\caption{CDN-P2P $\rho=1$.}
	\label{fig:4-4}
\end{minipage}
%\caption{main}
\label{fig:main}
\end{figure*}

Figure \ref{fig:4-0} shows energy usage for CDN server, router, total energy consumption for CDN scenario (without peer assisted).
We plot energy consumption for CDN server, router, clients, and total energy for every $T$ or $COP$ coefficient value.
In CDN only scenario, the energy consumption is increase as number of client increase.  
This is natural because increasing of clients imply to increasing of traffic from CDN server through router to clients.
The effect of different $T$ to total energy is small.  
It is between $1\%$ until $7.7\%$.

Figure \ref{fig:4-1} shows energy consumption for CDN, router, and total energy consumption for CDN-P2P scenario.
We use upload rate of seeders to leechers $\rho=0.25$.
We assume that CDN server always utilize under $50\%$.
For CDN server energy $E_d$, the usage of energy increase until number of seeders $n_s=500$.
On $n_s=500$ the CDN server right on $50\%$ utilization.
When CDN server on $50\%$ utilization, maximum number of seeders are $n_s=500$ and number of leechers can be served by seeders is $125$ peers.  
Therefore in this situation, CDN server can save energy, because with just $50\%$ utilization, additional $125$ peers are served from seeders.  
We can see this situation as flat line in fig.\ref{fig:4-1}.
Next, to be able to server more peers, we allow CDN server to increase the $62.5\%$ utilization.
With $62.5\%$ utilization, $625$ peers served by CDN server. 
Number of leechers can be supported by seeders are $156$ peers.
In this situation CDN server can save energy, because with just $62.5\%$ utilization and number additional $156$ peers are served from seeders.  
We can see this situation as flat line in fig.\ref{fig:4-1} from $N=625$ until $N=781$
In router case, we do not see router can get energy saving because number of traffic increase as increasing number of peers. 
For example, when CDN server on $50\%$ utilization, maximum number seeders are $n_s=500$ and number of leechers can be served by seeders is $125$ peers.
Traffic traverse through router is $500$Mbps plus additional $125$Mbps. 
We get $125$Mbps from $500$ multiply to upload rate of seeders $0.25$Mbps
Different air temperature supply, make different power consumption.  
With $T=25$ or $COP=3.194$, we can see the power consumption for all components decrease.
That's because energy needed to supply air cooling with temperature $T=25$ is less than  energy needed to supply air cooling with temperature $T=20$.
%The difference is from $7.3\%$ until $7.7\%$.

Next, Figure \ref{fig:4-2} shows energy consumption for CDN, router, and total energy consumption for CDN-P2P scenario.
We use upload rate of seeders to leechers $\rho=0.5$.
We assume that CDN server utilization under $50\%$.
For CDN server energy, the usage of energy increase until number of seeders $n_s=500$.
On $n_s=500$ the CDN server right on $50\%$ utilization.
When CDN server on $50\%$ utilization, maximum number of seeders are $n_s=500$ and number of leechers can be served by seeders are $250$ peers.
In this situation, CDN server can save energy, because with just $50\%$ utilization, additional $250$ peers are served from seeders. 
We can see this situation as flat line in fig.\ref{fig:4-1} from $N=500$ until $N=750$.
In order to allow more peers, then CDN server must allow to increase its utilization from $50\%$ to $75\%$.
Again we will see flat line in fig.\ref{fig:4-1} from $N=750$ until $N=1125$. 
That's because with CDN server utilization $75\%$, with number of seeders $n_s=750$ can also serve leechers $n_l=325$ leechers.
On the other hand, energy consumption of router increasing with the increasing number of peers because router needs to accommodate traffic from all peers. 

Figure \ref{fig:4-3} shows energy consumption for CDN, router, and total energy consumption for CDN-P2P scenario.  
We use upload rate of seeders to leechers $\rho=0.75$.
We assume that CDN server utilization under $50\%$.
The result almost same with previous. 
CDN server energy increase until number of seeders $n_s=500$.
When CDN server hit $50\%$ utilization, maximum number of seeders are $n_s=500$ and number of leechers can be served by seeders are $325$ peers. 
Therefore with same energy level on $50\%$ utilization the system can server additional $325$ peers. 
Again, for router energy consumption is increasing. 

Figure \ref{fig:4-4} shows energy consumption for CDN, router, and total energy consumption for CDN-P2P scenario.  
We use upload rate of seeders to leechers $\rho=1$.
We assume that CDN server utilization under $50\%$.
The result almost same with previous. 
CDN server energy increase until number of seeders $n_s=500$.
When CDN server hit $50\%$ utilization, maximum number of seeders are $n_s=500$ and number of leechers can be served by seeders are $500$ peers. 
Therefore with same energy consumption level on $50\%$ utilization the system can server additional $500$ peers. 
Once again, router energy consumption is increasing. 


\begin{figure*}[ht]
\centering
\begin{minipage}[b]{0.4\linewidth}
	\includegraphics[scale=0.6]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/diff3dimension.eps}
	\caption{Different power consumption between CDN and CDN-P2P for CDN server component with $\rho=0.25,0.5,0.75,1$.}
	\label{fig:diff1}
\end{minipage}
\hfill
\begin{minipage}[b]{0.4\linewidth}
	\includegraphics[scale=0.6]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/diff3dimension2.eps}
	\caption{Different power consumption between CDN and CDN-P2P for total system with $\rho=0.25,0.5,0.75,1$.}
	\label{fig:diff2}
\end{minipage}
\centering
\begin{minipage}[b]{0.4\linewidth}
	\includegraphics[scale=0.6]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/diff-3.eps}
	\caption{Different power consumption between CDN and CDN-P2P for CDN server component with $\rho=0.75$.}
	\label{fig:diffs1}
\end{minipage}
\hfill
\begin{minipage}[b]{0.4\linewidth}
	\includegraphics[scale=0.6]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/diff-3-total.eps}
	\caption{Different power consumption between CDN and CDN-P2P for total system with $\rho=0.75$.}
	\label{fig:diffs2}
\end{minipage}
%\caption{main}
\label{fig:maindiff}
\end{figure*}

Figure \ref{fig:diff1} shows percentage difference of energy consumption between CDN and CDN-P2P for CDN server component with $\rho=[0.25,0.5,0.75,1]$.
The power saving that CDN server get is from $3.8\%$ to $11\%$.
More clear figure is shown in fig.\ref{fig:diffs1} for $\rho=0.75$ where CDN server can save energy because the utilization of CDN server is same when the system has number of peers from $500$ to $875$ and from $875$ peers to $1531$ are handle with same CDN utilization.   
Figure \ref{fig:diff2} shows percentage difference of energy consumption between CDN and CDN-P2P for total system with $\rho=[0.25,0.5,0.75,1]$.
The power saving that total system get is from $0.1\%$ to $0.9\%$.
Figure \ref{fig:diffs2} reports percentage difference of energy consumption between CDN and CDN-P2P for total system with $\rho=0.75$.
While CDN server part can save more energy, due to peers high energy consumption then total energy saving in the system that we can get is small, from $0.2\%$ to $0.9\%$.


\subsection{Online Storage}

In peer-assisted online storage, user contribute their upload bandwidth to redistribute of a file that they are downloading or that they have cached locally.
We follow peer-assisted online storage model in \cite{Sun:2009:POS:1542245.1542249} as basis of our work. 
In peer-assisted online storage, users can browse a catalog of available files and asynchronously issue request to download a given file, which are ideally immediately satisfied by the system.
In order to reduce startup latency, first block of file must be downloaded from server \cite{5199550}.
In peer-assisted online storage, users interested to a specific file can retrieve it from servers (CDN) and from users storing copy of it in their computer or dedicated set top boxes/home gateway remotely.  
Peer-assisted online storage model in \cite{Sun:2009:POS:1542245.1542249}, the arrival process of request for considered file follow Poisson process, it takes into account multiple files of different popularity and server bandwidth provisioning.
For detail, we refer the readers to \cite{Sun:2009:POS:1542245.1542249,5199550,5061997}.
All numerical simulation parameters that we used in this section same as \cite{Sun:2009:POS:1542245.1542249}.


\begin{figure*}[ht]
\centering
\begin{minipage}[b]{0.3\linewidth}
	\includegraphics[scale=0.45]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/strategy1.eps}
	\caption{Power consumption of CDN server, router, and peers in lower bound strategy.}
	\label{fig:stg1}
\end{minipage}
\hfill
\centering
\begin{minipage}[b]{0.3\linewidth}
	\includegraphics[scale=0.45]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/strategy2.eps}
	\caption{Power consumption of CDN server, router, and peers in request driven strategy.}
	\label{fig:stg2}
\end{minipage}
\hfill
\centering
\begin{minipage}[b]{0.3\linewidth}
	\includegraphics[scale=0.45]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/strategy3.eps}
	\caption{Power consumption of CDN server, router, and peers, in water leveling strategy.}
	\label{fig:stg3}
\end{minipage}
%\caption{main}
\label{fig:storage}
\end{figure*}

\begin{figure*}[ht]
\centering
\begin{minipage}[b]{0.3\linewidth}
	\includegraphics[scale=0.45]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/diff-2to1.eps}
	\caption{Power consumption difference between request driven strategy and lower bound strategy.}
	\label{fig:diff2to1}
\end{minipage}
\hfill
\centering
\begin{minipage}[b]{0.3\linewidth}
	\includegraphics[scale=0.45]{../../../papers/p2p-cdn-latex/tex/ipsj/graphs/diff-3to1.eps}
	\caption{Power consumption difference between water leveling strategy and lower bound strategy.}
	\label{fig:diff3to1}
\end{minipage}
%\caption{main}
\label{fig:diffstrategy}
\end{figure*}

\section{Summary}\label{summary6}

In this paper, we have introduced the comparison of energy consumption between the peer-assisted CDN architecture and CDN architecture for live streaming and video on demand service.
Integrating peer to peer capability to assist the existing CDN has a potential to save energy consumption.
In this study, we show that event without explicitly considering energy consumption while assigning content, the peer assisted CDN can save energy consumption.
Our model shows that different peer-assisted CDN architecture for live streaming and online storage purpose can have different energy saving. 
Even different strategies in peer-assisted online storage can have different result.  

